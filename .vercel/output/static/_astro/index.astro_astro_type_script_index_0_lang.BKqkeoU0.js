let i=1,d=!1;const P=5,a={x:0,y:0,vx:0,vy:0},r={up:!1,down:!1,left:!1,right:!1},g=.6,q=.94,h=50,w={x:0,y:0};let T=[],u=.2,f=.2;const R=.2,B=12,H=6;let E=null,F=0;const W=600;let z=0;const U=300,Z=2200,N=1100,O=2e3,j=900,s=document.getElementById("stars"),o=s.getContext("2d"),J=document.getElementById("drift-container"),$=document.getElementById("warp-glow"),I=document.getElementById("rift-slit"),L=document.getElementById("vignette");function G(){s.width=window.innerWidth,s.height=window.innerHeight}function X(t){t||(t=Math.min(1200,Math.floor(s.width*s.height/4500))),T=[];for(let e=0;e<t;e++)T.push({x:Math.random()*s.width,y:Math.random()*s.height,z:Math.random()*1e3,size:Math.random()*1+.2,brightness:Math.random()*.3+.2})}function K(){o.fillStyle="rgba(0, 0, 0, 0.15)",o.fillRect(0,0,s.width,s.height);const t=s.width/2+a.x*.5,e=s.height/2+a.y*.5;T.forEach(n=>{n.z-=u*6,n.z<=0&&(n.z=1e3,n.x=Math.random()*s.width,n.y=Math.random()*s.height);const c=800/n.z,l=(n.x-t)*c+t,y=(n.y-e)*c+e,v=Math.max(.3,n.size*c*(u>2?1+(u-2)*.15:1)),p=245,k=242,S=234;if(u>2){const D=800/(n.z+u*6),A=(n.x-t)*D+t,C=(n.y-e)*D+e,x=o.createLinearGradient(A,C,l,y);x.addColorStop(0,`rgba(${p},${k},${S},0)`),x.addColorStop(1,`rgba(${p},${k},${S},${n.brightness*.6})`),o.beginPath(),o.strokeStyle=x,o.lineWidth=v*.5,o.moveTo(A,C),o.lineTo(l,y),o.stroke()}o.beginPath(),o.fillStyle=`rgba(${p},${k},${S},${n.brightness})`,o.arc(l,y,v,0,Math.PI*2),o.fill()}),u+=(f-u)*.04}function Q(){r.up&&(a.vy-=g),r.down&&(a.vy+=g),r.left&&(a.vx-=g),r.right&&(a.vx+=g),a.vx*=q,a.vy*=q,a.x+=a.vx,a.y+=a.vy,a.x=Math.max(-h,Math.min(h,a.x)),a.y=Math.max(-h,Math.min(h,a.y));const t=a.x+w.x*12,e=a.y+w.y*12;J.style.transform=`translate(${t}px, ${e}px)`}function Y(){K(),Q(),requestAnimationFrame(Y)}function M(){document.body.classList.remove("layer-1","layer-2","layer-3","layer-4","layer-5"),document.body.classList.add(`layer-${i}`)}function m(t){if(d||t<1||t>P||t===i)return;console.log(`[WARP] Layer ${i} -> ${t}`),d=!0,document.body.classList.add("transitioning");const e=document.querySelector(`.layer[data-layer="${i}"]`),n=document.querySelector(`.layer[data-layer="${t}"]`),c=e.querySelector(".layer-content"),l=n.querySelector(".layer-content");f=B,$.classList.add("active"),L.classList.add("active"),c.classList.add("warp-out"),e.classList.add("transitioning"),setTimeout(()=>{$.classList.remove("active")},600),setTimeout(()=>{e.classList.remove("active"),c.classList.remove("warp-out"),n.classList.add("active","transitioning"),l.classList.add("warp-in"),i=t,M()},N),setTimeout(()=>{l.classList.remove("warp-in"),e.classList.remove("transitioning"),n.classList.remove("transitioning"),L.classList.remove("active"),f=R,d=!1,document.body.classList.remove("transitioning")},Z)}function b(){if(d||i===1)return;const t=[2,3,4].filter(v=>v!==i),e=t[Math.floor(Math.random()*t.length)];console.log(`[RIFT FALL] Layer ${i} -> ${e}`),d=!0,document.body.classList.add("transitioning");const n=document.querySelector(`.layer[data-layer="${i}"]`),c=document.querySelector(`.layer[data-layer="${e}"]`),l=n.querySelector(".layer-content"),y=c.querySelector(".layer-content");f=H,I.classList.add("active"),L.classList.add("active"),l.classList.add("rift-out"),n.classList.add("transitioning"),setTimeout(()=>{I.classList.remove("active")},600),setTimeout(()=>{n.classList.remove("active"),l.classList.remove("rift-out"),c.classList.add("active","transitioning"),y.classList.add("rift-in"),i=e,M()},j),setTimeout(()=>{y.classList.remove("rift-in"),n.classList.remove("transitioning"),c.classList.remove("transitioning"),L.classList.remove("active"),f=R,d=!1,document.body.classList.remove("transitioning")},O)}function V(t){if(d)return;console.log(`[GATE] Navigating to ${t}`),d=!0,document.body.classList.add("transitioning"),f=B,$.classList.add("active"),document.querySelector(".layer.active").querySelector(".layer-content").classList.add("warp-out"),setTimeout(()=>{window.location.href=t},800)}document.addEventListener("keydown",t=>{if((t.key==="ArrowUp"||t.key==="w"||t.key==="W")&&(r.up=!0,t.preventDefault()),(t.key==="ArrowDown"||t.key==="s"||t.key==="S")&&(r.down=!0,t.preventDefault()),(t.key==="ArrowLeft"||t.key==="a"||t.key==="A")&&(r.left=!0,t.preventDefault()),(t.key==="ArrowRight"||t.key==="d"||t.key==="D")&&(r.right=!0,t.preventDefault()),t.key==="Enter"&&!t.repeat){t.preventDefault();const e=i%P+1;m(e)}(t.key==="f"||t.key==="F"||t.key===" ")&&!t.repeat&&(t.preventDefault(),i===1?m(2):b())});document.addEventListener("keyup",t=>{(t.key==="ArrowUp"||t.key==="w"||t.key==="W")&&(r.up=!1),(t.key==="ArrowDown"||t.key==="s"||t.key==="S")&&(r.down=!1),(t.key==="ArrowLeft"||t.key==="a"||t.key==="A")&&(r.left=!1),(t.key==="ArrowRight"||t.key==="d"||t.key==="D")&&(r.right=!1)});document.addEventListener("mousemove",t=>{w.x=(t.clientX/window.innerWidth-.5)*2,w.y=(t.clientY/window.innerHeight-.5)*2});document.addEventListener("click",t=>{if(t.target.closest("[data-gate]"))return;const e=Date.now();e-z<U&&(i===1?m(2):b()),z=e});document.querySelectorAll("[data-gate]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),V(t.getAttribute("href"))})});document.addEventListener("touchstart",t=>{t.target.closest("[data-gate]")||(F=Date.now(),E=setTimeout(()=>{i===1?m(2):b()},W))},{passive:!0});document.addEventListener("touchend",t=>{if(t.target.closest("[data-gate]"))return;clearTimeout(E),Date.now()-F<W&&m(i+1)},{passive:!0});document.addEventListener("touchmove",()=>{clearTimeout(E)},{passive:!0});G();X();M();Y();window.addEventListener("resize",()=>{G(),X()});console.log("[PORTAL] Initialized");
